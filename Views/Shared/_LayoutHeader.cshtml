@{
    var username = Context.Session.GetString("Username");
    var vaiTro = Context.Session.GetInt32("VaiTro");
}
@using WebBanGiayTheThao.Models @using System.Linq
@inject WebBanGiayTheThao.Services.IVoucherServices _voucherService

@{
    var listVoucher = await _voucherService.GetActiveAsync();
    int tongSoVoucherHienThi = listVoucher.Count;
}

@using WebBanGiayTheThao.Models 
@using System.Linq
@using Microsoft.AspNetCore.Http
@inject WebBanGiayTheThao.Services.IGioHangService _gioHangService

@{
    int UserId = Context.Session.GetInt32("UserId").GetValueOrDefault();
    var listGiohang = await _gioHangService.GetAllAsync(UserId);
    int TongSoGioHang = listGiohang.Count;
}

<nav class="fixed top-0 w-full z-50 liquid-glass transition-all duration-300">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="/" class="text-2xl font-bold tracking-tighter">
            SHOES<span class="text-gray-400">STORE</span>
        </a>

        <div class="hidden md:flex space-x-8 font-medium text-sm uppercase tracking-wide">

            <a asp-controller="Home" asp-action="TrangChu" class="hover:text-gray-500 transition">Trang chủ</a>
            <a asp-controller="SanPham" asp-action="TrangSanPham" class="hover:text-gray-500 transition">Sản phẩm</a>
            <a asp-controller="LienHe" asp-action="Index" class="hover:text-gray-500 transition">Liên hệ</a>
            <a asp-controller="Home" asp-action="GioiThieu" class="hover:text-gray-500 transition">Giới thiệu</a>

        </div>

        <div class="flex items-center space-x-4">

            <!-- Giỏ hàng -->
            <a asp-controller="GioHang"
               asp-action="TrangGioHang"
               class="relative p-2 hover:bg-gray-200 rounded-full transition">
                <i class="ph ph-shopping-cart text-xl"></i>
                <span class="absolute top-0 right-0 h-4 w-4 bg-black text-white text-[10px]
                             flex items-center justify-center rounded-full">
                    @TongSoGioHang
                </span>
            </a>

            <a asp-controller="Voucher"
               asp-action="TrangVoucher"
               class="relative p-2 hover:bg-gray-200 rounded-full transition"
               title="Kho Voucher">
                <i class="ph ph-ticket text-xl"></i>
                <span class="absolute top-0 right-0 h-4 w-4 bg-red-500 text-white text-[10px] flex items-center justify-center rounded-full">
                    @tongSoVoucherHienThi
                    </span>
            </a>


            @* ===== CHƯA ĐĂNG NHẬP ===== *@
            @if (string.IsNullOrEmpty(username))
            {
                <a href="#"
                   data-bs-toggle="modal"
                   data-bs-target="#loginModal"
                   class="hidden md:block px-5 py-2 text-sm font-semibold rounded-full
                              border border-gray-300 hover:bg-black hover:text-white transition">
                    Đăng nhập
                </a>

                <a href="#"
                   data-bs-toggle="modal"
                   data-bs-target="#registerModal"
                   class="hidden md:block px-5 py-2 text-sm font-semibold rounded-full
                              border border-gray-300 hover:bg-black hover:text-white transition">
                    Đăng ký
                </a>
            }
            else if (vaiTro == 0)
            {
                @* ===== KHÁCH HÀNG ===== *@

                <span class="hidden md:block text-sm font-semibold">
                    Xin chào, @username
                </span>

                <a asp-controller="NguoiDung"
                   asp-action="DangXuat"
                   class="hidden md:block px-5 py-2 text-sm font-semibold rounded-full
                              border border-gray-300 text-red-600
                              hover:bg-red-600 hover:text-white transition">
                    Đăng xuất
                </a>

                <!-- Dropdown -->
                <div class="dropdown relative">
                    <button type="button"
                            class="p-2 border rounded-full hover:bg-gray-100 transition"
                            data-bs-toggle="dropdown">
                        <i class="ph ph-list text-xl"></i>
                    </button>

                    <ul class="dropdown-menu dropdown-menu-end shadow rounded-3 p-2">
                        <li>
                            <a class="dropdown-item"
                               asp-controller="DonHang"
                               asp-action="LichSu">
                                Quản lí đơn hàng
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item"
                               asp-controller="NguoiDung"
                               asp-action="QuanLyTaiKhoanCaNhan">
                                Quản lí tài khoản cá nhân
                            </a>
                        </li>
                    </ul>
                </div>
            }
        </div>
    </div>
</nav>
